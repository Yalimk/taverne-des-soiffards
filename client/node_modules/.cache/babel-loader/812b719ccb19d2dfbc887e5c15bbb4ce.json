{"ast":null,"code":"import _defineProperty from\"C:/Users/virtuoworks/Desktop/taverne-des-soiffards/front-end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _regeneratorRuntime from\"C:/Users/virtuoworks/Desktop/taverne-des-soiffards/front-end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/virtuoworks/Desktop/taverne-des-soiffards/front-end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"C:/Users/virtuoworks/Desktop/taverne-des-soiffards/front-end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"C:/Users/virtuoworks/Desktop/taverne-des-soiffards/front-end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"C:/Users/virtuoworks/Desktop/taverne-des-soiffards/front-end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"C:/Users/virtuoworks/Desktop/taverne-des-soiffards/front-end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";// Native modules import\nimport React,{Component}from\"react\";import{Redirect}from\"react-router-dom\";// Personal modules import\nimport{isLoggedIn}from\"../../logic/auth/index\";import{viewPost,updatePost}from\"../../logic/post/apiPost\";import defaultPostPic from\"../../images/beautiful-sea.jpg\";var EditPost=/*#__PURE__*/function(_Component){_inherits(EditPost,_Component);var _super=_createSuper(EditPost);function EditPost(){var _this;_classCallCheck(this,EditPost);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={id:\"\",title:\"\",body:\"\",redirectionProfile:false,redirectionPosts:false,error:\"\",loading:false,fileSize:0};_this.init=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(postId){var data,_data$author;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return viewPost(postId);case 3:data=_context.sent;if(data.error){_this.setState({redirectionProfile:true});}else{// console.info(\n// `[front-end/src/post/EditPost.jsx => init:] : data.author._id: ${data.author._id}`\n// );\n_this.setState({id:(_data$author=data.author)===null||_data$author===void 0?void 0:_data$author._id,title:data.title,body:data.body,error:\"\"});}_context.next=10;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](0);console.error(\"[front-end/src/post/EditPost.jsx => catch:] : error:  \".concat(_context.t0));case 10:case\"end\":return _context.stop();}}},_callee,null,[[0,7]]);}));return function(_x){return _ref.apply(this,arguments);};}();_this.isValid=function(){var _this$state=_this.state,title=_this$state.title,body=_this$state.body,fileSize=_this$state.fileSize;if(fileSize>1000000){_this.setState({loading:false,error:\"Le poids du fichier ne doit pas dépasser 1Mb ! Déconne pas !\"});return false;}if(title.length===0||title.length>50){_this.setState({loading:false,error:\"Le titre est requis et doit faire moins de 50 caractères, marin d'eau douce !\"});return false;}if(body.length===0){_this.setState({loading:false,error:\"Un message est requis pour envoyer un... message, moussaillon.\"});return false;}return true;};_this.handleChange=function(name){return function(event){var _this$setState;_this.setState({error:\"\"});var value=name===\"photo\"?event.target.files[0]:event.target.value;var fileSize=name===\"photo\"?event.target.files[0].size:0;_this.postData.set(name,value);_this.setState((_this$setState={},_defineProperty(_this$setState,name,value),_defineProperty(_this$setState,\"fileSize\",fileSize),_this$setState));};};_this.submitPostUpdate=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(event){var postId,token,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:event.preventDefault();_this.setState({loading:true});if(!_this.isValid()){_context2.next=16;break;}postId=_this.props.match.params.postId;token=isLoggedIn().token;_context2.prev=5;_context2.next=8;return updatePost(postId,token,_this.postData);case 8:data=_context2.sent;if(data.error){_this.setState({error:data.error});}_this.setState({loading:false,title:\"\",body:\"\",redirectionProfile:true});_context2.next=16;break;case 13:_context2.prev=13;_context2.t0=_context2[\"catch\"](5);console.error(\"updatePost in EditPost coudldn't retrive data because of error: \".concat(_context2.t0,\".\"));case 16:case\"end\":return _context2.stop();}}},_callee2,null,[[5,13]]);}));return function(_x2){return _ref2.apply(this,arguments);};}();_this.postUpdateForm=function(title,body){return/*#__PURE__*/_jsxs(\"form\",{action:\"\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-muted\",children:\"Image\"}),/*#__PURE__*/_jsx(\"input\",{onChange:_this.handleChange(\"photo\"),type:\"file\",name:\"photo\",accept:\"image/*\",className:\"form-control\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-muted\",children:\"Titre\"}),/*#__PURE__*/_jsx(\"input\",{onChange:_this.handleChange(\"title\"),type:\"text\",name:\"title\",className:\"form-control\",value:title,autoFocus:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-muted\",children:\"Message\"}),/*#__PURE__*/_jsx(\"textarea\",{onChange:_this.handleChange(\"body\"),type:\"text\",name:\"body\",className:\"form-control\",value:body})]}),/*#__PURE__*/_jsx(\"button\",{onClick:_this.submitPostUpdate,className:\"btn btn-raised btn-primary\",children:\"Envoyer\"})]});};return _this;}_createClass(EditPost,[{key:\"componentDidMount\",value:function componentDidMount(){this.postData=new FormData();try{var postId=this.props.match.params.postId;if(postId){this.init(postId);}else{console.error(\"No postId found.\");}}catch(error){console.error(\"Something went wrong with componentDidMount method.\");}}},{key:\"render\",value:function render(){var _this$state2=this.state,id=_this$state2.id,title=_this$state2.title,body=_this$state2.body,redirectionProfile=_this$state2.redirectionProfile,error=_this$state2.error,loading=_this$state2.loading;var postId=this.props.match.params.postId;if(redirectionProfile){return/*#__PURE__*/_jsx(Redirect,{to:\"/post/\".concat(postId)});}if(id){var _isLoggedIn$user;return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"card-body\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-danger\",style:{display:error?\"\":\"none\"},children:error}),loading?/*#__PURE__*/_jsx(\"div\",{className:\"jumbotron text-center\",children:/*#__PURE__*/_jsx(\"h2\",{children:\"Loading...\"})}):\"\",/*#__PURE__*/_jsx(\"img\",{style:{height:\"200px\",width:\"auto\",boxShadow:\"3px 3px 10px grey\"},className:\"img-thumbnail mb-3\",src:\"\".concat(process.env.REACT_APP_API_URI,\"/post/photo/\").concat(postId,\"?\").concat(new Date().getTime()),onError:function onError(img){return img.target.src=\"\".concat(defaultPostPic);},alt:title}),/*#__PURE__*/_jsx(\"h3\",{className:\"card-title mt-3 mb-3\",children:title}),(isLoggedIn().user.right===process.env.REACT_APP_ADMIN_TITLE||((_isLoggedIn$user=isLoggedIn().user)===null||_isLoggedIn$user===void 0?void 0:_isLoggedIn$user._id)===id)&&this.postUpdateForm(title,body)]})});}else{var _isLoggedIn$user2;return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"card-body\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-danger\",style:{display:error?\"\":\"none\"},children:error}),loading?/*#__PURE__*/_jsx(\"div\",{className:\"jumbotron text-center\",children:/*#__PURE__*/_jsx(\"h2\",{children:\"Loading...\"})}):\"\",/*#__PURE__*/_jsx(\"img\",{style:{height:\"200px\",width:\"auto\"},className:\"img-thumbnail mb-3\",src:\"\".concat(process.env.REACT_APP_API_URI,\"/post/photo/\").concat(postId,\"?\").concat(new Date().getTime()),onError:function onError(img){return img.target.src=\"\".concat(defaultPostPic);},alt:title}),/*#__PURE__*/_jsx(\"h3\",{className:\"card-title mt-3 mb-3\",children:title}),(isLoggedIn().user.right===process.env.REACT_APP_ADMIN_TITLE||((_isLoggedIn$user2=isLoggedIn().user)===null||_isLoggedIn$user2===void 0?void 0:_isLoggedIn$user2._id)===id)&&this.postUpdateForm(title,body)]})});}}}]);return EditPost;}(Component);export default EditPost;","map":{"version":3,"sources":["C:/Users/virtuoworks/Desktop/taverne-des-soiffards/front-end/src/pages/post/EditPost.jsx"],"names":["React","Component","Redirect","isLoggedIn","viewPost","updatePost","defaultPostPic","EditPost","state","id","title","body","redirectionProfile","redirectionPosts","error","loading","fileSize","init","postId","data","setState","author","_id","console","isValid","length","handleChange","name","event","value","target","files","size","postData","set","submitPostUpdate","preventDefault","props","match","params","token","postUpdateForm","FormData","display","height","width","boxShadow","process","env","REACT_APP_API_URI","Date","getTime","img","src","user","right","REACT_APP_ADMIN_TITLE"],"mappings":"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","sourcesContent":["// Native modules import\r\nimport React, { Component } from \"react\";\r\nimport { Redirect } from \"react-router-dom\";\r\n\r\n// Personal modules import\r\nimport { isLoggedIn } from \"../../logic/auth/index\";\r\nimport { viewPost, updatePost } from \"../../logic/post/apiPost\";\r\nimport defaultPostPic from \"../../images/beautiful-sea.jpg\";\r\n\r\nclass EditPost extends Component {\r\n  state = {\r\n    id: \"\",\r\n    title: \"\",\r\n    body: \"\",\r\n    redirectionProfile: false,\r\n    redirectionPosts: false,\r\n    error: \"\",\r\n    loading: false,\r\n    fileSize: 0,\r\n  };\r\n\r\n  init = async (postId) => {\r\n    // console.info(`[front-end/src/post/EditPost.jsx => init:] : postId: ${postId}`);\r\n    try {\r\n      const data = await viewPost(postId);\r\n      if (data.error) {\r\n        this.setState({\r\n          redirectionProfile: true,\r\n        });\r\n      } else {\r\n        // console.info(\r\n          // `[front-end/src/post/EditPost.jsx => init:] : data.author._id: ${data.author._id}`\r\n        // );\r\n        this.setState({\r\n          id: data.author?._id,\r\n          title: data.title,\r\n          body: data.body,\r\n          error: \"\",\r\n        });\r\n      }\r\n    } catch (error) {\r\n      console.error(\r\n        `[front-end/src/post/EditPost.jsx => catch:] : error:  ${error}`\r\n      );\r\n    }\r\n  };\r\n\r\n  componentDidMount() {\r\n    this.postData = new FormData();\r\n    try {\r\n      const postId = this.props.match.params.postId;\r\n      if (postId) {\r\n        this.init(postId);\r\n      } else {\r\n        console.error(\"No postId found.\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Something went wrong with componentDidMount method.\");\r\n    }\r\n  }\r\n\r\n  isValid = () => {\r\n    const { title, body, fileSize } = this.state;\r\n    if (fileSize > 1000000) {\r\n      this.setState({\r\n        loading: false,\r\n        error: \"Le poids du fichier ne doit pas dépasser 1Mb ! Déconne pas !\",\r\n      });\r\n      return false;\r\n    }\r\n    if (title.length === 0 || title.length > 50) {\r\n      this.setState({\r\n        loading: false,\r\n        error:\r\n          \"Le titre est requis et doit faire moins de 50 caractères, marin d'eau douce !\",\r\n      });\r\n      return false;\r\n    }\r\n    if (body.length === 0) {\r\n      this.setState({\r\n        loading: false,\r\n        error: `Un message est requis pour envoyer un... message, moussaillon.`,\r\n      });\r\n      return false;\r\n    }\r\n    return true;\r\n  };\r\n\r\n  handleChange = (name) => (event) => {\r\n    this.setState({ error: \"\" });\r\n    const value = name === \"photo\" ? event.target.files[0] : event.target.value;\r\n\r\n    const fileSize = name === \"photo\" ? event.target.files[0].size : 0;\r\n    this.postData.set(name, value);\r\n    this.setState({ [name]: value, fileSize });\r\n  };\r\n\r\n  submitPostUpdate = async (event) => {\r\n    event.preventDefault();\r\n    this.setState({ loading: true });\r\n\r\n    if (this.isValid()) {\r\n      const postId = this.props.match.params.postId;\r\n      const token = isLoggedIn().token;\r\n      try {\r\n        const data = await updatePost(postId, token, this.postData);\r\n        if (data.error) {\r\n          this.setState({ error: data.error });\r\n        }\r\n        this.setState({\r\n          loading: false,\r\n          title: \"\",\r\n          body: \"\",\r\n          redirectionProfile: true,\r\n        });\r\n      } catch (error) {\r\n        console.error(\r\n          `updatePost in EditPost coudldn't retrive data because of error: ${error}.`\r\n        );\r\n      }\r\n    }\r\n  };\r\n\r\n  postUpdateForm = (title, body) => (\r\n    <form action=\"\">\r\n      <div className=\"form-group\">\r\n        <label className=\"text-muted\">Image</label>\r\n        <input\r\n          onChange={this.handleChange(\"photo\")}\r\n          type=\"file\"\r\n          name=\"photo\"\r\n          accept=\"image/*\"\r\n          className=\"form-control\"\r\n        />\r\n      </div>\r\n      <div className=\"form-group\">\r\n        <label className=\"text-muted\">Titre</label>\r\n        <input\r\n          onChange={this.handleChange(\"title\")}\r\n          type=\"text\"\r\n          name=\"title\"\r\n          className=\"form-control\"\r\n          value={title}\r\n          autoFocus\r\n        />\r\n      </div>\r\n      <div className=\"form-group\">\r\n        <label className=\"text-muted\">Message</label>\r\n        <textarea\r\n          onChange={this.handleChange(\"body\")}\r\n          type=\"text\"\r\n          name=\"body\"\r\n          className=\"form-control\"\r\n          value={body}\r\n        />\r\n      </div>\r\n\r\n      <button\r\n        onClick={this.submitPostUpdate}\r\n        className=\"btn btn-raised btn-primary\"\r\n      >\r\n        Envoyer\r\n      </button>\r\n    </form>\r\n  );\r\n\r\n  render() {\r\n    const { id, title, body, redirectionProfile, error, loading } = this.state;\r\n    const postId = this.props.match.params.postId;\r\n    if (redirectionProfile) {\r\n      return <Redirect to={`/post/${postId}`} />;\r\n    }\r\n    if (id) {\r\n      return (\r\n        <div>\r\n          <div className=\"card-body\">\r\n            <div\r\n              className=\"alert alert-danger\"\r\n              style={{ display: error ? \"\" : \"none\" }}\r\n            >\r\n              {error}\r\n            </div>\r\n\r\n            {loading ? (\r\n              <div className=\"jumbotron text-center\">\r\n                <h2>Loading...</h2>\r\n              </div>\r\n            ) : (\r\n              \"\"\r\n            )}\r\n            <img\r\n              style={{ height: \"200px\", width: \"auto\", boxShadow: \"3px 3px 10px grey\" }}\r\n              className=\"img-thumbnail mb-3\"\r\n              src={`${process.env.REACT_APP_API_URI}/post/photo/${postId}?${new Date().getTime()}`}\r\n              onError={(img) => (img.target.src = `${defaultPostPic}`)}\r\n              alt={title}\r\n            />\r\n\r\n            <h3 className=\"card-title mt-3 mb-3\">{title}</h3>\r\n\r\n            {(isLoggedIn().user.right === process.env.REACT_APP_ADMIN_TITLE ||\r\n              isLoggedIn().user?._id === id) && this.postUpdateForm(title, body)}\r\n          </div>\r\n        </div>\r\n      );\r\n    } else {\r\n      return (\r\n        <div>\r\n          <div className=\"card-body\">\r\n            <div\r\n              className=\"alert alert-danger\"\r\n              style={{ display: error ? \"\" : \"none\" }}\r\n            >\r\n              {error}\r\n            </div>\r\n\r\n            {loading ? (\r\n              <div className=\"jumbotron text-center\">\r\n                <h2>Loading...</h2>\r\n              </div>\r\n            ) : (\r\n              \"\"\r\n            )}\r\n            <img\r\n              style={{ height: \"200px\", width: \"auto\" }}\r\n              className=\"img-thumbnail mb-3\"\r\n              src={`${process.env.REACT_APP_API_URI}/post/photo/${postId}?${new Date().getTime()}`}\r\n              onError={(img) => (img.target.src = `${defaultPostPic}`)}\r\n              alt={title}\r\n            />\r\n\r\n            <h3 className=\"card-title mt-3 mb-3\">{title}</h3>\r\n\r\n            {(isLoggedIn().user.right === process.env.REACT_APP_ADMIN_TITLE ||\r\n              isLoggedIn().user?._id === id) && this.postUpdateForm(title, body)}\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nexport default EditPost;\r\n"]},"metadata":{},"sourceType":"module"}