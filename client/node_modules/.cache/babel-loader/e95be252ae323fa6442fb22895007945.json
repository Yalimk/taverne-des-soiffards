{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/virtuoworks/Desktop/taverne-des-soiffards/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/virtuoworks/Desktop/taverne-des-soiffards/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"C:/Users/virtuoworks/Desktop/taverne-des-soiffards/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"C:/Users/virtuoworks/Desktop/taverne-des-soiffards/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"C:/Users/virtuoworks/Desktop/taverne-des-soiffards/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"C:/Users/virtuoworks/Desktop/taverne-des-soiffards/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import{jsx as _jsx}from\"react/jsx-runtime\";// Native modules import\nimport React,{Component}from\"react\";import{Redirect}from\"react-router-dom\";// Personal modules import\nimport{isLoggedIn,signout}from\"../../logic/auth/index\";import{remove}from\"../../logic/user/apiUser\";var DeleteUser=/*#__PURE__*/function(_Component){_inherits(DeleteUser,_Component);var _super=_createSuper(DeleteUser);function DeleteUser(){var _this;_classCallCheck(this,DeleteUser);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={redirectionSignIn:false,allMighty:false};_this.deleteAccount=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var token,userId,response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:token=isLoggedIn().token;userId=_this.props.userId;_context.prev=2;_context.next=5;return remove(userId,token);case 5:response=_context.sent;if(response.error){console.error(\"An error occured during account deletion: \".concat(response.error,\".\"));}else{if(!isLoggedIn().user.right==='Roi des Pirates'){signout(function(){console.log(\"User has been deleted.\");});_this.setState({redirectionSignIn:true});}}_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](2);console.error(\"Couldn't get a response from server because of error: \".concat(_context.t0,\".\"));case 12:case\"end\":return _context.stop();}}},_callee,null,[[2,9]]);}));_this.deleteConfirmation=function(){var answer,kingAnswer;if(isLoggedIn().user.right===process.env.REACT_APP_ADMIN_TITLE){kingAnswer=window.confirm(\"Tu vas supprimer le profil de ce Pirate de fa\\xE7on irr\\xE9versible ; m\\xEAme toi tu n'y pourras plus rien, mon Roi.\\n        Es-tu bien certain que c'est ce que tu veux faire ?\");}else{answer=window.confirm(\"Tu vas supprimer ton profil de fa\\xE7on TOTALEMENT d\\xE9finitive, moussaillon, tu es s\\xFBr ?\\n         M\\xEAme le Roi des Pirates n'y pourra plus rien, j'te pr\\xE9viens...\");}if(answer||kingAnswer){_this.deleteAccount();}};return _this;}_createClass(DeleteUser,[{key:\"componentDidMount\",value:function componentDidMount(){if(isLoggedIn().user.right===process.env.REACT_APP_ADMIN_TITLE){this.setState({allMighty:true});}}},{key:\"render\",value:function render(){var _this$state=this.state,redirectionSignIn=_this$state.redirectionSignIn,allMighty=_this$state.allMighty;var currentUserId=this.props.userId;if(redirectionSignIn){return/*#__PURE__*/_jsx(Redirect,{to:\"/signin\"});}if(allMighty&&isLoggedIn().user._id!==currentUserId){return/*#__PURE__*/_jsx(\"button\",{onClick:this.deleteConfirmation,className:\"btn btn-raised btn-dark font-weight-bold\",children:\"Supprimer en tant que Roi\"});}else{return/*#__PURE__*/_jsx(\"button\",{onClick:this.deleteConfirmation,className:\"btn btn-raised btn-danger\",children:\"Quitter d\\xE9finitivement la Taverne\"});}}}]);return DeleteUser;}(Component);export default DeleteUser;","map":{"version":3,"sources":["C:/Users/virtuoworks/Desktop/taverne-des-soiffards/client/src/components/user/DeleteUser.jsx"],"names":["React","Component","Redirect","isLoggedIn","signout","remove","DeleteUser","state","redirectionSignIn","allMighty","deleteAccount","token","userId","props","response","error","console","user","right","log","setState","deleteConfirmation","answer","kingAnswer","process","env","REACT_APP_ADMIN_TITLE","window","confirm","currentUserId","_id"],"mappings":"wjCAAA;AACA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,KAAiC,OAAjC,CACA,OAASC,QAAT,KAAyB,kBAAzB,CAEA;AACA,OAASC,UAAT,CAAqBC,OAArB,KAAoC,wBAApC,CACA,OAASC,MAAT,KAAuB,0BAAvB,C,GAEMC,CAAAA,U,2UACJC,K,CAAQ,CACNC,iBAAiB,CAAE,KADb,CAENC,SAAS,CAAE,KAFL,C,OAWRC,a,sEAAgB,6JACRC,KADQ,CACAR,UAAU,GAAGQ,KADb,CAERC,MAFQ,CAEC,MAAKC,KAAL,CAAWD,MAFZ,uCAIWP,CAAAA,MAAM,CAACO,MAAD,CAASD,KAAT,CAJjB,QAING,QAJM,eAKZ,GAAIA,QAAQ,CAACC,KAAb,CAAoB,CAClBC,OAAO,CAACD,KAAR,qDAC+CD,QAAQ,CAACC,KADxD,OAGD,CAJD,IAIO,CACL,GAAI,CAACZ,UAAU,GAAGc,IAAb,CAAkBC,KAAnB,GAA6B,iBAAjC,CAAoD,CAClDd,OAAO,CAAC,UAAM,CACZY,OAAO,CAACG,GAAR,2BACD,CAFM,CAAP,CAGA,MAAKC,QAAL,CAAc,CACZZ,iBAAiB,CAAE,IADP,CAAd,EAGD,CACF,CAlBW,+EAoBZQ,OAAO,CAACD,KAAR,mFApBY,oE,SA0BhBM,kB,CAAqB,UAAM,CACzB,GAAIC,CAAAA,MAAJ,CAAYC,UAAZ,CACA,GAAIpB,UAAU,GAAGc,IAAb,CAAkBC,KAAlB,GAA4BM,OAAO,CAACC,GAAR,CAAYC,qBAA5C,CAAmE,CACjEH,UAAU,CAAGI,MAAM,CAACC,OAAP,qLAAb,CAID,CALD,IAKO,CACLN,MAAM,CAAGK,MAAM,CAACC,OAAP,gLAAT,CAID,CACD,GAAIN,MAAM,EAAIC,UAAd,CAA0B,CACxB,MAAKb,aAAL,GACD,CACF,C,mGAhDmB,CAClB,GAAIP,UAAU,GAAGc,IAAb,CAAkBC,KAAlB,GAA4BM,OAAO,CAACC,GAAR,CAAYC,qBAA5C,CAAmE,CACjE,KAAKN,QAAL,CAAc,CAAEX,SAAS,CAAE,IAAb,CAAd,EACD,CACF,C,uCA8CQ,iBACkC,KAAKF,KADvC,CACCC,iBADD,aACCA,iBADD,CACoBC,SADpB,aACoBA,SADpB,CAEP,GAAMoB,CAAAA,aAAa,CAAG,KAAKhB,KAAL,CAAWD,MAAjC,CACA,GAAIJ,iBAAJ,CAAuB,CACrB,mBAAO,KAAC,QAAD,EAAU,EAAE,CAAC,SAAb,EAAP,CACD,CAED,GAAIC,SAAS,EAAIN,UAAU,GAAGc,IAAb,CAAkBa,GAAlB,GAA0BD,aAA3C,CAA0D,CACxD,mBACE,eACE,OAAO,CAAE,KAAKR,kBADhB,CAEE,SAAS,CAAC,0CAFZ,uCADF,CAQD,CATD,IASO,CACL,mBACE,eACE,OAAO,CAAE,KAAKA,kBADhB,CAEE,SAAS,CAAC,2BAFZ,kDADF,CAQD,CACF,C,wBAlFsBpB,S,EAqFzB,cAAeK,CAAAA,UAAf","sourcesContent":["// Native modules import\r\nimport React, { Component } from \"react\";\r\nimport { Redirect } from \"react-router-dom\";\r\n\r\n// Personal modules import\r\nimport { isLoggedIn, signout } from \"../../logic/auth/index\";\r\nimport { remove } from \"../../logic/user/apiUser\";\r\n\r\nclass DeleteUser extends Component {\r\n  state = {\r\n    redirectionSignIn: false,\r\n    allMighty: false,\r\n  };\r\n\r\n  componentDidMount() {\r\n    if (isLoggedIn().user.right === process.env.REACT_APP_ADMIN_TITLE) {\r\n      this.setState({ allMighty: true });\r\n    }\r\n  };\r\n\r\n  deleteAccount = async () => {\r\n    const token = isLoggedIn().token;\r\n    const userId = this.props.userId;\r\n    try {\r\n      const response = await remove(userId, token);\r\n      if (response.error) {\r\n        console.error(\r\n          `An error occured during account deletion: ${response.error}.`\r\n        );\r\n      } else {\r\n        if (!isLoggedIn().user.right === 'Roi des Pirates') {\r\n          signout(() => {\r\n            console.log(`User has been deleted.`);\r\n          });\r\n          this.setState({\r\n            redirectionSignIn: true,\r\n          });\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error(\r\n        `Couldn't get a response from server because of error: ${error}.`\r\n      );\r\n    }\r\n  };\r\n\r\n  deleteConfirmation = () => {\r\n    let answer, kingAnswer;\r\n    if (isLoggedIn().user.right === process.env.REACT_APP_ADMIN_TITLE) {\r\n      kingAnswer = window.confirm(\r\n        `Tu vas supprimer le profil de ce Pirate de façon irréversible ; même toi tu n'y pourras plus rien, mon Roi.\r\n        Es-tu bien certain que c'est ce que tu veux faire ?`\r\n      );\r\n    } else {\r\n      answer = window.confirm(\r\n        `Tu vas supprimer ton profil de façon TOTALEMENT définitive, moussaillon, tu es sûr ?\r\n         Même le Roi des Pirates n'y pourra plus rien, j'te préviens...`\r\n      );\r\n    }\r\n    if (answer || kingAnswer) {\r\n      this.deleteAccount();\r\n    }\r\n  };\r\n\r\n  render() {\r\n    const { redirectionSignIn, allMighty } = this.state;\r\n    const currentUserId = this.props.userId;\r\n    if (redirectionSignIn) {\r\n      return <Redirect to=\"/signin\" />;\r\n    }\r\n    \r\n    if (allMighty && isLoggedIn().user._id !== currentUserId) {\r\n      return (\r\n        <button\r\n          onClick={this.deleteConfirmation}\r\n          className=\"btn btn-raised btn-dark font-weight-bold\"\r\n        >\r\n          Supprimer en tant que Roi\r\n        </button>\r\n      );\r\n    } else {\r\n      return (\r\n        <button\r\n          onClick={this.deleteConfirmation}\r\n          className=\"btn btn-raised btn-danger\"\r\n        >\r\n          Quitter définitivement la Taverne\r\n        </button>\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nexport default DeleteUser;\r\n"]},"metadata":{},"sourceType":"module"}