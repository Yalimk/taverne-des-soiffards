{"ast":null,"code":"import _defineProperty from\"C:/Users/virtuoworks/Desktop/taverne-des-soiffards/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _regeneratorRuntime from\"C:/Users/virtuoworks/Desktop/taverne-des-soiffards/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/virtuoworks/Desktop/taverne-des-soiffards/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"C:/Users/virtuoworks/Desktop/taverne-des-soiffards/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"C:/Users/virtuoworks/Desktop/taverne-des-soiffards/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"C:/Users/virtuoworks/Desktop/taverne-des-soiffards/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"C:/Users/virtuoworks/Desktop/taverne-des-soiffards/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";/* eslint-disable no-useless-escape */ // Navite modules import\nimport React,{Component}from\"react\";import{Redirect}from\"react-router-dom\";// Personal modules import\nimport{isLoggedIn}from\"../../logic/auth/index\";import{read,updateUser,updateInfo}from\"../../logic/user/apiUser\";import defaultProfilePic from\"../../images/default-image.png\";var EditProfile=/*#__PURE__*/function(_Component){_inherits(EditProfile,_Component);var _super=_createSuper(EditProfile);function EditProfile(){var _this;_classCallCheck(this,EditProfile);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={id:\"\",pseudo:\"\",email:\"\",password:\"\",about:\"\",role:\"\",hobbies:\"\",redirectionProfile:false,error:\"\",fileSize:0,loading:false};_this.init=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(userId){var token,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;token=isLoggedIn().token;_context.next=4;return read(userId,token);case 4:data=_context.sent;if(data.error){_this.setState={redirectionProfile:true};}else{// console.log(\"[front-end/src/user/EditProfile => init => data: \", data);\n_this.setState({id:data._id,pseudo:data.pseudo,email:data.email,about:data.about,// this used to be data.about || \"\" (don't rembember why I wrote it as such, maybe this will solve my bug of the bio not being rendered)\nrole:data.role,hobbies:data.hobbies,error:\"\"});}_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](0);console.error(\"The init method encountered the following error: \".concat(_context.t0));case 11:case\"end\":return _context.stop();}}},_callee,null,[[0,8]]);}));return function(_x){return _ref.apply(this,arguments);};}();_this.handleChange=function(name){return function(event){var _this$setState;_this.setState({error:\"\"});var value=name===\"photo\"?event.target.files[0]:event.target.value;var fileSize=name===\"photo\"?event.target.files[0].size:0;_this.userData.set(name,value);_this.setState((_this$setState={},_defineProperty(_this$setState,name,value),_defineProperty(_this$setState,\"fileSize\",fileSize),_this$setState));};};_this.isValid=function(){var _this$state=_this.state,pseudo=_this$state.pseudo,email=_this$state.email,password=_this$state.password,fileSize=_this$state.fileSize,about=_this$state.about,hobbies=_this$state.hobbies,role=_this$state.role;if(pseudo.length===0&&email.length===0&&password.length===0&&about.length===0&&hobbies.length===0&&role.length===0){_this.setState({loading:false,error:\"Il n'y a rien à changer, là, moussaillon !\"});return false;}else{if(fileSize>1000000){_this.setState({loading:false,error:\"Le poids du fichier ne doit pas dépasser 1Mb ! Déconne pas !\"});return false;}if(pseudo.length>=1&&(pseudo.length<4||pseudo.length>30)){_this.setState({loading:false,error:\"Ton pseudo doit faire entre 4 et 30 caractères, marin d'eau douce !\"});return false;}if(password.length>=1&&!/^(?=(?:[^A-Z]*[A-Z]){1,}(?![^A-Z]*[A-Z]))(?=(?:[^a-z]*[a-z]){1,}(?![^a-z]*[a-z]))(?=(?:[^0-9]*[0-9]){1,}(?![^0-9]*[0-9]))(?=(?:[^!'#\\$%&'\\(\\)\\*\\+,-\\.\\/:;<=>\\?@[\\]\\^_`\\{\\|}~]*[!'#\\$%&'\\(\\)\\*\\+,-\\.\\/:;<=>\\?@[\\]\\^_`\\{\\|}~]){1,}(?![^!'#\\$%&'\\(\\)\\*\\+,-\\.\\/:;<=>\\?@[\\]\\^_`\\{\\|}~]*[!'#\\$%&'\\(\\)\\*\\+,-\\.\\/:;<=>\\?@[\\]\\^_`\\{\\|}~])).{8,}$/.test(password)){_this.setState({loading:false,error:\"Ton mot de passe doit contenir au moins 8 caractères dont une lettre minuscule, une lettre majuscule, un chiffre et un caractère spécial.\"});return false;}if(email.length>=1&&!/^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/.test(email)){_this.setState({loading:false,error:\"Tu dois renseigner une adresse de courrier électronique valide, moussailon !\"});return false;}if(about.length>300){_this.setState({loading:false,error:\"Tu te pr\\xE9sentes, moussaillon, tu ne r\\xE9diges pas ta biographie ! Pas plus de 300 caract\\xE8res !\"});return false;}if(hobbies.length>300){_this.setState({loading:false,error:\"Juste tes hobbies, moussaillon, pas ta vie enti\\xE8re ! Pas plus de 300 caract\\xE8res !\"});return false;}if(role.length>50){_this.setState({loading:false,error:\"Ton r\\xF4le, moussaillon, sois concis et pr\\xE9cis ! Pas plus de 50 caract\\xE8res !\"});return false;}return true;}};_this.updateSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(event){var userId,token,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:event.preventDefault();_this.setState({loading:true});if(!_this.isValid()){_context2.next=9;break;}userId=_this.props.match.params.userId;token=isLoggedIn().token;// console.log(\n//   `[front-end/src/user/EditProfile => updateSubmit:180] => userId: ${userId} and token: ${token} and this.userData: ${this.userData}`\n// );\n_context2.next=7;return updateUser(userId,token,_this.userData);case 7:data=_context2.sent;// console.info(`[front-end/src/user/EditProfile => updateSubmit => after updateUser:183]: data: ${data}`)\nif(data.error){_this.setState({error:data.error});}else if(isLoggedIn().user.right===process.env.REACT_APP_ADMIN_TITLE){_this.setState({redirectionProfile:true});}else{// console.info(`[front-end/src/user/EditProfile => updateSubmit => before updateInfo:190]: data: ${data}`)\nupdateInfo(data,function(){_this.setState({redirectionProfile:true});});}case 9:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}();_this.updateForm=function(pseudo,email,password,about,role,hobbies){return/*#__PURE__*/_jsxs(\"form\",{action:\"\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-muted\",children:\"Photo de profil (ou de face...)\"}),/*#__PURE__*/_jsx(\"input\",{onChange:_this.handleChange(\"photo\"),type:\"file\",name:\"photo\",accept:\"image/*\",className:\"form-control\"}),/*#__PURE__*/_jsx(\"small\",{id:\"pictureHelp\",className:\"form-text text-muted\",children:\"S\\xE9lectionnez de pr\\xE9f\\xE9rence une photo carr\\xE9e (exemple : 400px * 400px)\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-muted\",children:\"Pseudo\"}),/*#__PURE__*/_jsx(\"input\",{onChange:_this.handleChange(\"pseudo\"),type:\"text\",name:\"pseudo\",className:\"form-control\",value:pseudo,placeholder:\"Laisser vide pour conserver le pseudo actuel.\",autoFocus:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-muted\",children:\"E-mail\"}),/*#__PURE__*/_jsx(\"input\",{onChange:_this.handleChange(\"email\"),type:\"email\",name:\"email\",className:\"form-control\",value:email,placeholder:\"Laisser vide pour conserver l'e-mail actuel.\"}),/*#__PURE__*/_jsx(\"small\",{id:\"emailHelp\",className:\"form-text text-muted\",children:\"Votre e-mail ne sera partag\\xE9 avec aucune tierse partie\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-muted\",children:\"Mot de passe\"}),/*#__PURE__*/_jsx(\"input\",{onChange:_this.handleChange(\"password\"),type:\"password\",name:\"password\",className:\"form-control\",value:password,placeholder:\"Laisser vide pour conserver le mot de passe actuel.\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-muted\",children:\"Bio\"}),/*#__PURE__*/_jsx(\"textarea\",{onChange:_this.handleChange(\"about\"),type:\"text\",name:\"about\",className:\"form-control\",value:about,placeholder:\"Raconte-nous ton histoire, flibustier ! Ou raconte des conneries, c'est toi qui vois...\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-muted\",children:\"R\\xF4le favori\"}),/*#__PURE__*/_jsx(\"textarea\",{onChange:_this.handleChange(\"role\"),type:\"text\",name:\"role\",className:\"form-control\",value:role,placeholder:\"Quel r\\xF4le pr\\xE9f\\xE8res-tu assurer, moussaillon ? Les canons ou la chair \\xE0 canon ?\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-muted\",children:\"Loisirs\"}),/*#__PURE__*/_jsx(\"textarea\",{onChange:_this.handleChange(\"hobbies\"),type:\"text\",name:\"hobbies\",className:\"form-control\",value:hobbies,placeholder:\"As-tu d'autres hobbies \\xE0 part voler, piller et boire du rhum, pirate ?\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:_this.updateSubmit,type:\"submit\",className:\"btn btn-raised btn-primary\",children:\"Modifier\"})]});};return _this;}_createClass(EditProfile,[{key:\"componentDidMount\",value:function componentDidMount(){this.userData=new FormData();try{var userId=this.props.match.params.userId;if(userId){this.init(userId);}else{console.error(\"No userId found.\");}}catch(error){console.error(\"Something went wrong with componentDidMount method.\");}}},{key:\"render\",value:function render(){var _this$state2=this.state,id=_this$state2.id,pseudo=_this$state2.pseudo,email=_this$state2.email,password=_this$state2.password,about=_this$state2.about,role=_this$state2.role,hobbies=_this$state2.hobbies,redirectionProfile=_this$state2.redirectionProfile,error=_this$state2.error,loading=_this$state2.loading;if(redirectionProfile){return/*#__PURE__*/_jsx(Redirect,{to:\"/user/\".concat(id)});}var photoUri=id?\"\".concat(process.env.REACT_APP_API_URI,\"/user/photo/\").concat(id,\"?\").concat(new Date().getTime()):\"\".concat(defaultProfilePic);if(photoUri){return/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"mt-5 mb-5\",children:\"Modifier les informations du compte\"}),/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-danger\",style:{display:error?\"\":\"none\"},children:error}),loading?/*#__PURE__*/_jsx(\"div\",{className:\"jumbotron text-center\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"Chargement...\"})}):\"\",/*#__PURE__*/_jsx(\"img\",{style:{height:\"200px\",width:\"auto\"},className:\"img-thumbnail\",src:photoUri,onError:function onError(img){return img.target.src=\"\".concat(defaultProfilePic);},alt:pseudo}),(isLoggedIn().user.right===process.env.REACT_APP_ADMIN_TITLE||isLoggedIn().user._id===id)&&this.updateForm(pseudo,email,password,about,role,hobbies)]});}else{return/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"mt-5 mb-5\",children:\"Modifier les informations du compte\"}),/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-danger\",style:{display:error?\"\":\"none\"},children:error}),loading?/*#__PURE__*/_jsx(\"div\",{className:\"jumbotron text-center\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"Chargement...\"})}):\"\",/*#__PURE__*/_jsx(\"img\",{style:{height:\"200px\",width:\"auto\"},className:\"img-thumbnail\",src:photoUri,onError:function onError(img){return img.target.src=\"\".concat(defaultProfilePic);},alt:pseudo}),(isLoggedIn().user.right===process.env.REACT_APP_ADMIN_TITLE||isLoggedIn().user._id===id)&&this.updateForm(pseudo,email,password,about,role,hobbies)]});}}}]);return EditProfile;}(Component);export default EditProfile;","map":{"version":3,"sources":["C:/Users/virtuoworks/Desktop/taverne-des-soiffards/client/src/pages/user/EditProfile.jsx"],"names":["React","Component","Redirect","isLoggedIn","read","updateUser","updateInfo","defaultProfilePic","EditProfile","state","id","pseudo","email","password","about","role","hobbies","redirectionProfile","error","fileSize","loading","init","userId","token","data","setState","_id","console","handleChange","name","event","value","target","files","size","userData","set","isValid","length","test","updateSubmit","preventDefault","props","match","params","user","right","process","env","REACT_APP_ADMIN_TITLE","updateForm","FormData","photoUri","REACT_APP_API_URI","Date","getTime","display","height","width","img","src"],"mappings":"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","sourcesContent":["/* eslint-disable no-useless-escape */\r\n// Navite modules import\r\nimport React, { Component } from \"react\";\r\nimport { Redirect } from \"react-router-dom\";\r\n\r\n// Personal modules import\r\nimport { isLoggedIn } from \"../../logic/auth/index\";\r\nimport { read, updateUser, updateInfo } from \"../../logic/user/apiUser\";\r\nimport defaultProfilePic from \"../../images/default-image.png\";\r\n\r\nclass EditProfile extends Component {\r\n  state = {\r\n    id: \"\",\r\n    pseudo: \"\",\r\n    email: \"\",\r\n    password: \"\",\r\n    about: \"\",\r\n    role: \"\",\r\n    hobbies: \"\",\r\n    redirectionProfile: false,\r\n    error: \"\",\r\n    fileSize: 0,\r\n    loading: false,\r\n  };\r\n\r\n  init = async (userId) => {\r\n    try {\r\n      const token = isLoggedIn().token;\r\n      const data = await read(userId, token);\r\n      if (data.error) {\r\n        this.setState = {\r\n          redirectionProfile: true,\r\n        };\r\n      } else {\r\n        // console.log(\"[front-end/src/user/EditProfile => init => data: \", data);\r\n        this.setState({\r\n          id: data._id,\r\n          pseudo: data.pseudo,\r\n          email: data.email,\r\n          about: data.about, // this used to be data.about || \"\" (don't rembember why I wrote it as such, maybe this will solve my bug of the bio not being rendered)\r\n          role: data.role,\r\n          hobbies: data.hobbies,\r\n          error: \"\",\r\n        });\r\n      }\r\n    } catch (error) {\r\n      console.error(\r\n        `The init method encountered the following error: ${error}`\r\n      );\r\n    }\r\n  };\r\n\r\n  componentDidMount() {\r\n    this.userData = new FormData();\r\n    try {\r\n      const userId = this.props.match.params.userId;\r\n      if (userId) {\r\n        this.init(userId);\r\n      } else {\r\n        console.error(\"No userId found.\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Something went wrong with componentDidMount method.\");\r\n    }\r\n  }\r\n\r\n  handleChange = (name) => (event) => {\r\n    this.setState({ error: \"\" });\r\n    const value = name === \"photo\" ? event.target.files[0] : event.target.value;\r\n    const fileSize = name === \"photo\" ? event.target.files[0].size : 0;\r\n    this.userData.set(name, value);\r\n    this.setState({\r\n      [name]: value,\r\n      fileSize,\r\n    });\r\n  };\r\n\r\n  isValid = () => {\r\n    const {\r\n      pseudo,\r\n      email,\r\n      password,\r\n      fileSize,\r\n      about,\r\n      hobbies,\r\n      role,\r\n    } = this.state;\r\n    if (\r\n      pseudo.length === 0 &&\r\n      email.length === 0 &&\r\n      password.length === 0 &&\r\n      about.length === 0 &&\r\n      hobbies.length === 0 &&\r\n      role.length === 0\r\n    ) {\r\n      this.setState({\r\n        loading: false,\r\n        error: \"Il n'y a rien à changer, là, moussaillon !\",\r\n      });\r\n      return false;\r\n    } else {\r\n      if (fileSize > 1000000) {\r\n        this.setState({\r\n          loading: false,\r\n          error: \"Le poids du fichier ne doit pas dépasser 1Mb ! Déconne pas !\",\r\n        });\r\n        return false;\r\n      }\r\n      if (pseudo.length >= 1 && (pseudo.length < 4 || pseudo.length > 30)) {\r\n        this.setState({\r\n          loading: false,\r\n          error:\r\n            \"Ton pseudo doit faire entre 4 et 30 caractères, marin d'eau douce !\",\r\n        });\r\n        return false;\r\n      }\r\n      if (\r\n        password.length >= 1 &&\r\n        !/^(?=(?:[^A-Z]*[A-Z]){1,}(?![^A-Z]*[A-Z]))(?=(?:[^a-z]*[a-z]){1,}(?![^a-z]*[a-z]))(?=(?:[^0-9]*[0-9]){1,}(?![^0-9]*[0-9]))(?=(?:[^!'#\\$%&'\\(\\)\\*\\+,-\\.\\/:;<=>\\?@[\\]\\^_`\\{\\|}~]*[!'#\\$%&'\\(\\)\\*\\+,-\\.\\/:;<=>\\?@[\\]\\^_`\\{\\|}~]){1,}(?![^!'#\\$%&'\\(\\)\\*\\+,-\\.\\/:;<=>\\?@[\\]\\^_`\\{\\|}~]*[!'#\\$%&'\\(\\)\\*\\+,-\\.\\/:;<=>\\?@[\\]\\^_`\\{\\|}~])).{8,}$/.test(\r\n          password\r\n        )\r\n      ) {\r\n        this.setState({\r\n          loading: false,\r\n          error:\r\n            \"Ton mot de passe doit contenir au moins 8 caractères dont une lettre minuscule, une lettre majuscule, un chiffre et un caractère spécial.\",\r\n        });\r\n        return false;\r\n      }\r\n      if (\r\n        email.length >= 1 &&\r\n        !/^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/.test(\r\n          email\r\n        )\r\n      ) {\r\n        this.setState({\r\n          loading: false,\r\n          error:\r\n            \"Tu dois renseigner une adresse de courrier électronique valide, moussailon !\",\r\n        });\r\n        return false;\r\n      }\r\n      if (about.length > 300) {\r\n        this.setState({\r\n          loading: false,\r\n          error: `Tu te présentes, moussaillon, tu ne rédiges pas ta biographie ! Pas plus de 300 caractères !`,\r\n        });\r\n        return false;\r\n      }\r\n      if (hobbies.length > 300) {\r\n        this.setState({\r\n          loading: false,\r\n          error: `Juste tes hobbies, moussaillon, pas ta vie entière ! Pas plus de 300 caractères !`,\r\n        });\r\n        return false;\r\n      }\r\n      if (role.length > 50) {\r\n        this.setState({\r\n          loading: false,\r\n          error: `Ton rôle, moussaillon, sois concis et précis ! Pas plus de 50 caractères !`,\r\n        });\r\n        return false;\r\n      }\r\n      return true;\r\n    }\r\n  };\r\n\r\n  updateSubmit = async (event) => {\r\n    event.preventDefault();\r\n    this.setState({ loading: true });\r\n    if (this.isValid()) {\r\n      const userId = this.props.match.params.userId;\r\n      const token = isLoggedIn().token;\r\n      // console.log(\r\n      //   `[front-end/src/user/EditProfile => updateSubmit:180] => userId: ${userId} and token: ${token} and this.userData: ${this.userData}`\r\n      // );\r\n      const data = await updateUser(userId, token, this.userData);\r\n      // console.info(`[front-end/src/user/EditProfile => updateSubmit => after updateUser:183]: data: ${data}`)\r\n      if (data.error) {\r\n        this.setState({ error: data.error });\r\n      } else if (isLoggedIn().user.right === process.env.REACT_APP_ADMIN_TITLE) {\r\n        this.setState({ redirectionProfile: true })\r\n      } else {\r\n        // console.info(`[front-end/src/user/EditProfile => updateSubmit => before updateInfo:190]: data: ${data}`)\r\n        updateInfo(data, () => {\r\n          this.setState({ redirectionProfile: true });\r\n        });\r\n      }\r\n    }\r\n  };\r\n\r\n  updateForm = (pseudo, email, password, about, role, hobbies) => (\r\n    <form action=\"\">\r\n      <div className=\"form-group\">\r\n        <label className=\"text-muted\">Photo de profil (ou de face...)</label>\r\n        <input\r\n          onChange={this.handleChange(\"photo\")}\r\n          type=\"file\"\r\n          name=\"photo\"\r\n          accept=\"image/*\"\r\n          className=\"form-control\"\r\n        />\r\n        <small id=\"pictureHelp\" className=\"form-text text-muted\">\r\n          Sélectionnez de préférence une photo carrée (exemple : 400px * 400px)\r\n        </small>\r\n      </div>\r\n      <div className=\"form-group\">\r\n        <label className=\"text-muted\">Pseudo</label>\r\n        <input\r\n          onChange={this.handleChange(\"pseudo\")}\r\n          type=\"text\"\r\n          name=\"pseudo\"\r\n          className=\"form-control\"\r\n          value={pseudo}\r\n          placeholder=\"Laisser vide pour conserver le pseudo actuel.\"\r\n          autoFocus\r\n        />\r\n      </div>\r\n      <div className=\"form-group\">\r\n        <label className=\"text-muted\">E-mail</label>\r\n        <input\r\n          onChange={this.handleChange(\"email\")}\r\n          type=\"email\"\r\n          name=\"email\"\r\n          className=\"form-control\"\r\n          value={email}\r\n          placeholder=\"Laisser vide pour conserver l'e-mail actuel.\"\r\n        />\r\n        <small id=\"emailHelp\" className=\"form-text text-muted\">\r\n          Votre e-mail ne sera partagé avec aucune tierse partie\r\n        </small>\r\n      </div>\r\n      <div className=\"form-group\">\r\n        <label className=\"text-muted\">Mot de passe</label>\r\n        <input\r\n          onChange={this.handleChange(\"password\")}\r\n          type=\"password\"\r\n          name=\"password\"\r\n          className=\"form-control\"\r\n          value={password}\r\n          placeholder=\"Laisser vide pour conserver le mot de passe actuel.\"\r\n        />\r\n      </div>\r\n      <div className=\"form-group\">\r\n        <label className=\"text-muted\">Bio</label>\r\n        <textarea\r\n          onChange={this.handleChange(\"about\")}\r\n          type=\"text\"\r\n          name=\"about\"\r\n          className=\"form-control\"\r\n          value={about}\r\n          placeholder=\"Raconte-nous ton histoire, flibustier ! Ou raconte des conneries, c'est toi qui vois...\"\r\n        />\r\n      </div>\r\n      <div className=\"form-group\">\r\n        <label className=\"text-muted\">Rôle favori</label>\r\n        <textarea\r\n          onChange={this.handleChange(\"role\")}\r\n          type=\"text\"\r\n          name=\"role\"\r\n          className=\"form-control\"\r\n          value={role}\r\n          placeholder=\"Quel rôle préfères-tu assurer, moussaillon ? Les canons ou la chair à canon ?\"\r\n        />\r\n      </div>\r\n      <div className=\"form-group\">\r\n        <label className=\"text-muted\">Loisirs</label>\r\n        <textarea\r\n          onChange={this.handleChange(\"hobbies\")}\r\n          type=\"text\"\r\n          name=\"hobbies\"\r\n          className=\"form-control\"\r\n          value={hobbies}\r\n          placeholder=\"As-tu d'autres hobbies à part voler, piller et boire du rhum, pirate ?\"\r\n        />\r\n      </div>\r\n      <button\r\n        onClick={this.updateSubmit}\r\n        type=\"submit\"\r\n        className=\"btn btn-raised btn-primary\"\r\n      >\r\n        Modifier\r\n      </button>\r\n    </form>\r\n  );\r\n\r\n  render() {\r\n    const {\r\n      id,\r\n      pseudo,\r\n      email,\r\n      password,\r\n      about,\r\n      role,\r\n      hobbies,\r\n      redirectionProfile,\r\n      error,\r\n      loading,\r\n    } = this.state;\r\n    if (redirectionProfile) {\r\n      return <Redirect to={`/user/${id}`} />;\r\n    }\r\n\r\n    const photoUri = id\r\n      ? `${\r\n          process.env.REACT_APP_API_URI\r\n        }/user/photo/${id}?${new Date().getTime()}`\r\n      : `${defaultProfilePic}`;\r\n\r\n    if (photoUri) {\r\n      return (\r\n        <div className=\"container\">\r\n          <h2 className=\"mt-5 mb-5\">Modifier les informations du compte</h2>\r\n          <div\r\n            className=\"alert alert-danger\"\r\n            style={{ display: error ? \"\" : \"none\" }}\r\n          >\r\n            {error}\r\n          </div>\r\n          {loading ? (\r\n            <div className=\"jumbotron text-center\">\r\n              <h3>Chargement...</h3>\r\n            </div>\r\n          ) : (\r\n            \"\"\r\n          )}\r\n  \r\n          <img\r\n            style={{ height: \"200px\", width: \"auto\" }}\r\n            className=\"img-thumbnail\"\r\n            src={photoUri}\r\n            onError={(img) => (img.target.src = `${defaultProfilePic}`)}\r\n            alt={pseudo}\r\n          />\r\n          {/* {console.log('user.right', isLoggedIn().user.right)} */}\r\n          {(isLoggedIn().user.right === process.env.REACT_APP_ADMIN_TITLE ||\r\n            isLoggedIn().user._id === id) &&\r\n              this.updateForm(pseudo, email, password, about, role, hobbies)}\r\n        </div>\r\n      );\r\n    } else {\r\n      return (\r\n        <div className=\"container\">\r\n          <h2 className=\"mt-5 mb-5\">Modifier les informations du compte</h2>\r\n          <div\r\n            className=\"alert alert-danger\"\r\n            style={{ display: error ? \"\" : \"none\" }}\r\n          >\r\n            {error}\r\n          </div>\r\n          {loading ? (\r\n            <div className=\"jumbotron text-center\">\r\n              <h3>Chargement...</h3>\r\n            </div>\r\n          ) : (\r\n            \"\"\r\n          )}\r\n  \r\n          <img\r\n            style={{ height: \"200px\", width: \"auto\" }}\r\n            className=\"img-thumbnail\"\r\n            src={photoUri}\r\n            onError={(img) => (img.target.src = `${defaultProfilePic}`)}\r\n            alt={pseudo}\r\n          />\r\n          {/* {console.log('user.right', isLoggedIn().user.right)} */}\r\n          {(isLoggedIn().user.right === process.env.REACT_APP_ADMIN_TITLE ||\r\n            isLoggedIn().user._id === id) &&\r\n              this.updateForm(pseudo, email, password, about, role, hobbies)}\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nexport default EditProfile;\r\n"]},"metadata":{},"sourceType":"module"}