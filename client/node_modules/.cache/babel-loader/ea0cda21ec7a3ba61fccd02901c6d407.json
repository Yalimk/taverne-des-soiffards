{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/virtuoworks/Desktop/taverne-des-soiffards/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/virtuoworks/Desktop/taverne-des-soiffards/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _defineProperty from\"C:/Users/virtuoworks/Desktop/taverne-des-soiffards/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"C:/Users/virtuoworks/Desktop/taverne-des-soiffards/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"C:/Users/virtuoworks/Desktop/taverne-des-soiffards/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"C:/Users/virtuoworks/Desktop/taverne-des-soiffards/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"C:/Users/virtuoworks/Desktop/taverne-des-soiffards/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";/* eslint-disable no-useless-escape */ // Navite modules import\nimport React,{Component}from\"react\";import{Redirect}from\"react-router-dom\";// Personal modules import\nimport{isLoggedIn}from\"../../logic/auth/index\";import{createPost}from\"../../logic/post/apiPost\";var NewPost=/*#__PURE__*/function(_Component){_inherits(NewPost,_Component);var _super=_createSuper(NewPost);function NewPost(){var _this;_classCallCheck(this,NewPost);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={title:\"\",body:\"\",photo:\"\",error:\"\",user:{},fileSize:0,loading:false,redirectionProfile:false};_this.handleChange=function(name){return function(event){var _this$setState;_this.setState({error:\"\"});var value=name===\"photo\"?event.target.files[0]:event.target.value;var fileSize=name===\"photo\"?event.target.files[0].size:0;_this.postData.set(name,value);_this.setState((_this$setState={},_defineProperty(_this$setState,name,value),_defineProperty(_this$setState,\"fileSize\",fileSize),_this$setState));};};_this.isValid=function(){var _this$state=_this.state,title=_this$state.title,body=_this$state.body,fileSize=_this$state.fileSize;if(fileSize>1000000){_this.setState({loading:false,error:\"Le poids du fichier ne doit pas dépasser 1Mb ! Déconne pas !\"});return false;}if(title.length===0||title.length>50){_this.setState({loading:false,error:\"Le titre est requis et doit faire moins de 50 caractères, marin d'eau douce !\"});return false;}if(body.length===0){_this.setState({loading:false,error:\"Un message est requis pour envoyer un... message, moussaillon.\"});return false;}return true;};_this.postSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event){var userId,token,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:event.preventDefault();_this.setState({loading:true});if(!_this.isValid()){_context.next=9;break;}userId=isLoggedIn().user._id;token=isLoggedIn().token;_context.next=7;return createPost(userId,token,_this.postData);case 7:data=_context.sent;if(data.error){_this.setState({error:data.error});}else{_this.setState({loading:false,title:\"\",body:\"\",photo:\"\",redirectionProfile:true});}case 9:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();_this.postForm=function(title,body){return/*#__PURE__*/_jsxs(\"form\",{action:\"\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-muted\",children:\"Image\"}),/*#__PURE__*/_jsx(\"input\",{onChange:_this.handleChange(\"photo\"),type:\"file\",accept:\"image/*\",className:\"form-control\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-muted\",children:\"Titre\"}),/*#__PURE__*/_jsx(\"input\",{onChange:_this.handleChange(\"title\"),type:\"text\",className:\"form-control\",value:title})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-muted\",children:\"Message\"}),/*#__PURE__*/_jsx(\"textarea\",{onChange:_this.handleChange(\"body\"),type:\"body\",className:\"form-control\",value:body})]}),/*#__PURE__*/_jsx(\"button\",{onClick:_this.postSubmit,type:\"submit\",className:\"btn btn-raised btn-primary\",children:\"Envoyer\"})]});};return _this;}_createClass(NewPost,[{key:\"componentDidMount\",// constructor(props) {\n//   super(props);\n//   this.state = {\n//     title: \"\",\n//     body: \"\",\n//     photo: \"\",\n//     error: \"\",\n//     user: {},\n//     fileSize: 0,\n//     loading: false,\n//     redirectionProfile: false,\n//   };\n// }\nvalue:function componentDidMount(){this.postData=new FormData();try{this.setState({user:isLoggedIn().user});}catch(error){console.error(\"Something went wrong with componentDidMount method.\");}}},{key:\"render\",value:function render(){var _this$state2=this.state,title=_this$state2.title,body=_this$state2.body,user=_this$state2.user,error=_this$state2.error,loading=_this$state2.loading,redirectionProfile=_this$state2.redirectionProfile;if(redirectionProfile){return/*#__PURE__*/_jsx(Redirect,{to:\"/user/\".concat(user._id)});}return/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"mt-5 mb-5\",children:\"Ecrire un message\"}),/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-danger\",style:{display:error?\"\":\"none\"},children:error}),loading?/*#__PURE__*/_jsx(\"div\",{className:\"jumbotron text-center\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"Chargement...\"})}):\"\",this.postForm(title,body)]});}}]);return NewPost;}(Component);export default NewPost;","map":{"version":3,"sources":["C:/Users/virtuoworks/Desktop/taverne-des-soiffards/client/src/pages/post/NewPost.jsx"],"names":["React","Component","Redirect","isLoggedIn","createPost","NewPost","state","title","body","photo","error","user","fileSize","loading","redirectionProfile","handleChange","name","event","setState","value","target","files","size","postData","set","isValid","length","postSubmit","preventDefault","userId","_id","token","data","postForm","FormData","console","display"],"mappings":"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","sourcesContent":["/* eslint-disable no-useless-escape */\r\n// Navite modules import\r\nimport React, { Component } from \"react\";\r\nimport { Redirect } from \"react-router-dom\";\r\n\r\n// Personal modules import\r\nimport { isLoggedIn } from \"../../logic/auth/index\";\r\nimport { createPost } from \"../../logic/post/apiPost\";\r\n\r\nclass NewPost extends Component {\r\n  state = {\r\n    title: \"\",\r\n    body: \"\",\r\n    photo: \"\",\r\n    error: \"\",\r\n    user: {},\r\n    fileSize: 0,\r\n    loading: false,\r\n    redirectionProfile: false,\r\n  };\r\n  // constructor(props) {\r\n  //   super(props);\r\n  //   this.state = {\r\n  //     title: \"\",\r\n  //     body: \"\",\r\n  //     photo: \"\",\r\n  //     error: \"\",\r\n  //     user: {},\r\n  //     fileSize: 0,\r\n  //     loading: false,\r\n  //     redirectionProfile: false,\r\n  //   };\r\n  // }\r\n\r\n  componentDidMount() {\r\n    this.postData = new FormData();\r\n    try {\r\n      this.setState({\r\n        user: isLoggedIn().user,\r\n      });\r\n    } catch (error) {\r\n      console.error(\"Something went wrong with componentDidMount method.\");\r\n    }\r\n  }\r\n\r\n  handleChange = (name) => (event) => {\r\n    this.setState({ error: \"\" });\r\n    const value = name === \"photo\" ? event.target.files[0] : event.target.value;\r\n    const fileSize =\r\n      name === \"photo\" ? event.target.files[0].size : 0;\r\n    this.postData.set(name, value);\r\n    this.setState({\r\n      [name]: value,\r\n      fileSize,\r\n    });\r\n  };\r\n\r\n  isValid = () => {\r\n    const { title, body, fileSize } = this.state;\r\n    if (fileSize > 1000000) {\r\n      this.setState({\r\n        loading: false,\r\n        error: \"Le poids du fichier ne doit pas dépasser 1Mb ! Déconne pas !\",\r\n      });\r\n      return false;\r\n    }\r\n    if (title.length === 0 || title.length > 50) {\r\n      this.setState({\r\n        loading: false,\r\n        error:\r\n          \"Le titre est requis et doit faire moins de 50 caractères, marin d'eau douce !\",\r\n      });\r\n      return false;\r\n    }\r\n    if (body.length === 0) {\r\n      this.setState({\r\n        loading: false,\r\n        error: `Un message est requis pour envoyer un... message, moussaillon.`,\r\n      });\r\n      return false;\r\n    }\r\n    return true;\r\n  };\r\n\r\n  postSubmit = async (event) => {\r\n    event.preventDefault();\r\n    this.setState({ loading: true });\r\n    \r\n    if (this.isValid()) {\r\n      const userId = isLoggedIn().user._id;\r\n      const token = isLoggedIn().token;\r\n      const data = await createPost(userId, token, this.postData);\r\n      if (data.error) {\r\n        this.setState({ error: data.error });\r\n      } else {\r\n        this.setState({\r\n          loading: false,\r\n          title: \"\",\r\n          body: \"\",\r\n          photo: \"\",\r\n          redirectionProfile: true\r\n        })\r\n      }\r\n    }\r\n  };\r\n\r\n  postForm = (title, body) => (\r\n    <form action=\"\">\r\n      <div className=\"form-group\">\r\n        <label className=\"text-muted\">Image</label>\r\n        <input\r\n          onChange={this.handleChange(\"photo\")}\r\n          type=\"file\"\r\n          accept=\"image/*\"\r\n          className=\"form-control\"\r\n        />\r\n      </div>\r\n      <div className=\"form-group\">\r\n        <label className=\"text-muted\">Titre</label>\r\n        <input\r\n          onChange={this.handleChange(\"title\")}\r\n          type=\"text\"\r\n          className=\"form-control\"\r\n          value={title}\r\n        />\r\n      </div>\r\n      <div className=\"form-group\">\r\n        <label className=\"text-muted\">Message</label>\r\n        <textarea\r\n          onChange={this.handleChange(\"body\")}\r\n          type=\"body\"\r\n          className=\"form-control\"\r\n          value={body}\r\n        />\r\n      </div>\r\n      <button\r\n        onClick={this.postSubmit}\r\n        type=\"submit\"\r\n        className=\"btn btn-raised btn-primary\"\r\n      >\r\n        Envoyer\r\n      </button>\r\n    </form>\r\n  );\r\n\r\n\r\n\r\n  render() {\r\n    const {\r\n      title,\r\n      body,\r\n      user,\r\n      error,\r\n      loading,\r\n      redirectionProfile\r\n    } = this.state;\r\n\r\n    if (redirectionProfile) {\r\n      return <Redirect to={`/user/${user._id}`} />;\r\n    }\r\n\r\n    return (\r\n      <div className=\"container\">\r\n        <h2 className=\"mt-5 mb-5\">Ecrire un message</h2>\r\n        <div\r\n          className=\"alert alert-danger\"\r\n          style={{ display: error ? \"\" : \"none\" }}\r\n        >\r\n          {error}\r\n        </div>\r\n        {loading ? (\r\n          <div className=\"jumbotron text-center\">\r\n            <h3>Chargement...</h3>\r\n          </div>\r\n        ) : (\r\n          \"\"\r\n        )}\r\n\r\n        {this.postForm(title, body)}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default NewPost;\r\n"]},"metadata":{},"sourceType":"module"}