{"ast":null,"code":"import _toConsumableArray from\"C:/Users/virtuoworks/Desktop/taverne-des-soiffards/front-end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _classCallCheck from\"C:/Users/virtuoworks/Desktop/taverne-des-soiffards/front-end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"C:/Users/virtuoworks/Desktop/taverne-des-soiffards/front-end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"C:/Users/virtuoworks/Desktop/taverne-des-soiffards/front-end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"C:/Users/virtuoworks/Desktop/taverne-des-soiffards/front-end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";/* eslint-disable no-lone-blocks */ // Native modules import\nimport React,{Component}from\"react\";// Personal modules import\nimport ChatMessage from\"../../components/chat/ChatMessage\";import ChatForm from\"../../components/chat/ChatForm\";import{isLoggedIn}from\"../../logic/auth/index\";// Constants definition\nvar URL=\"ws://localhost:9092\";// eslint-disable-next-line no-empty-pattern\nvar Taverne=/*#__PURE__*/function(_Component){_inherits(Taverne,_Component);var _super=_createSuper(Taverne);function Taverne(){var _this;_classCallCheck(this,Taverne);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={pseudo:\"\",messages:[]};_this.socket=new WebSocket(URL);_this.addMessage=function(message){return _this.setState(function(state){return{messages:[message].concat(_toConsumableArray(state.messages))};});};_this.submitMessage=function(messageString){var messageData={pseudo:_this.state.pseudo,message:messageString};_this.socket.send(JSON.stringify(messageData));_this.addMessage(messageData);};return _this;}_createClass(Taverne,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;this.socket.onopen=function(data){if(isLoggedIn()){var pirateName=isLoggedIn().user.pseudo;// console.log('data', data);\n_this2.setState({pseudo:pirateName});// console.log(`${pirateName} s'est connecté au tchat.`);\n}else{_this2.setState({pseudo:\"Pirate inconnu\"});// console.log(`Un pirate inconnu s'est connecté au tchat.`);\n}};this.socket.onmessage=function(message){var messageData=JSON.parse(message.data);_this2.addMessage(messageData);};this.socket.onclose=function(){_this2.setState({socket:new WebSocket(URL)});};}},{key:\"render\",value:function render(){var _this3=this;var messages=this.state.messages;return/*#__PURE__*/_jsxs(\"div\",{className:\"container jumbotron\",children:[/*#__PURE__*/_jsx(ChatForm,{socket:this.socket,onSubmitMessage:function onSubmitMessage(messageString){return _this3.submitMessage(messageString);}}),messages.map(function(message,index){return/*#__PURE__*/_jsx(ChatMessage,{message:message.message,pseudo:message.pseudo},index);})]});}}]);return Taverne;}(Component);;export default Taverne;","map":{"version":3,"sources":["C:/Users/virtuoworks/Desktop/taverne-des-soiffards/front-end/src/pages/core/Taverne.jsx"],"names":["React","Component","ChatMessage","ChatForm","isLoggedIn","URL","Taverne","state","pseudo","messages","socket","WebSocket","addMessage","message","setState","submitMessage","messageString","messageData","send","JSON","stringify","onopen","data","pirateName","user","onmessage","parse","onclose","map","index"],"mappings":"+8BAAA,mC,CACA;AACA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,KAAiC,OAAjC,CAEA;AACA,MAAOC,CAAAA,WAAP,KAAwB,mCAAxB,CACA,MAAOC,CAAAA,QAAP,KAAqB,gCAArB,CACA,OAASC,UAAT,KAA2B,wBAA3B,CAEA;AACA,GAAMC,CAAAA,GAAG,sBAAT,CAEA;GACMC,CAAAA,O,+TACJC,K,CAAQ,CACNC,MAAM,CAAE,EADF,CAENC,QAAQ,CAAE,EAFJ,C,OAKRC,M,CAAS,GAAIC,CAAAA,SAAJ,CAAcN,GAAd,C,OAETO,U,CAAa,SAACC,OAAD,QACX,OAAKC,QAAL,CAAc,SAACP,KAAD,QAAY,CACxBE,QAAQ,EAAGI,OAAH,4BAAeN,KAAK,CAACE,QAArB,EADgB,CAAZ,EAAd,CADW,E,OAKbM,a,CAAgB,SAACC,aAAD,CAAmB,CACjC,GAAMC,CAAAA,WAAW,CAAG,CAAET,MAAM,CAAE,MAAKD,KAAL,CAAWC,MAArB,CAA6BK,OAAO,CAAEG,aAAtC,CAApB,CACA,MAAKN,MAAL,CAAYQ,IAAZ,CAAiBC,IAAI,CAACC,SAAL,CAAeH,WAAf,CAAjB,EACA,MAAKL,UAAL,CAAgBK,WAAhB,EACD,C,gGAEmB,iBAClB,KAAKP,MAAL,CAAYW,MAAZ,CAAqB,SAACC,IAAD,CAAU,CAC7B,GAAIlB,UAAU,EAAd,CAAkB,CAChB,GAAMmB,CAAAA,UAAU,CAAGnB,UAAU,GAAGoB,IAAb,CAAkBhB,MAArC,CACA;AACA,MAAI,CAACM,QAAL,CAAc,CACZN,MAAM,CAAEe,UADI,CAAd,EAGA;AACD,CAPD,IAOO,CACL,MAAI,CAACT,QAAL,CAAc,CACZN,MAAM,CAAE,gBADI,CAAd,EAGA;AACD,CACF,CAdD,CAgBA,KAAKE,MAAL,CAAYe,SAAZ,CAAwB,SAACZ,OAAD,CAAa,CACnC,GAAMI,CAAAA,WAAW,CAAGE,IAAI,CAACO,KAAL,CAAWb,OAAO,CAACS,IAAnB,CAApB,CACA,MAAI,CAACV,UAAL,CAAgBK,WAAhB,EACD,CAHD,CAKA,KAAKP,MAAL,CAAYiB,OAAZ,CAAsB,UAAM,CAC1B,MAAI,CAACb,QAAL,CAAc,CACZJ,MAAM,CAAE,GAAIC,CAAAA,SAAJ,CAAcN,GAAd,CADI,CAAd,EAGD,CAJD,CAKD,C,uCAEQ,oBACCI,CAAAA,QADD,CACc,KAAKF,KADnB,CACCE,QADD,CAEP,mBACE,aAAK,SAAS,CAAC,qBAAf,wBACE,KAAC,QAAD,EACE,MAAM,CAAE,KAAKC,MADf,CAEE,eAAe,CAAE,yBAACM,aAAD,QAAmB,CAAA,MAAI,CAACD,aAAL,CAAmBC,aAAnB,CAAnB,EAFnB,EADF,CAKGP,QAAQ,CAACmB,GAAT,CAAa,SAACf,OAAD,CAAUgB,KAAV,qBACZ,KAAC,WAAD,EAEE,OAAO,CAAEhB,OAAO,CAACA,OAFnB,CAGE,MAAM,CAAEA,OAAO,CAACL,MAHlB,EACOqB,KADP,CADY,EAAb,CALH,GADF,CAeD,C,qBAjEmB5B,S,EAkErB,CAED,cAAeK,CAAAA,OAAf","sourcesContent":["/* eslint-disable no-lone-blocks */\r\n// Native modules import\r\nimport React, { Component } from \"react\";\r\n\r\n// Personal modules import\r\nimport ChatMessage from \"../../components/chat/ChatMessage\";\r\nimport ChatForm from \"../../components/chat/ChatForm\";\r\nimport { isLoggedIn } from \"../../logic/auth/index\";\r\n\r\n// Constants definition\r\nconst URL = `ws://localhost:9092`;\r\n\r\n// eslint-disable-next-line no-empty-pattern\r\nclass Taverne extends Component {\r\n  state = {\r\n    pseudo: \"\",\r\n    messages: [],\r\n  };\r\n\r\n  socket = new WebSocket(URL);\r\n\r\n  addMessage = (message) =>\r\n    this.setState((state) => ({\r\n      messages: [message, ...state.messages],\r\n    }));\r\n\r\n  submitMessage = (messageString) => {\r\n    const messageData = { pseudo: this.state.pseudo, message: messageString };\r\n    this.socket.send(JSON.stringify(messageData));\r\n    this.addMessage(messageData);\r\n  };\r\n\r\n  componentDidMount() {\r\n    this.socket.onopen = (data) => {\r\n      if (isLoggedIn()) {\r\n        const pirateName = isLoggedIn().user.pseudo;\r\n        // console.log('data', data);\r\n        this.setState({\r\n          pseudo: pirateName,\r\n        });\r\n        // console.log(`${pirateName} s'est connecté au tchat.`);\r\n      } else {\r\n        this.setState({\r\n          pseudo: \"Pirate inconnu\",\r\n        });\r\n        // console.log(`Un pirate inconnu s'est connecté au tchat.`);\r\n      }\r\n    };\r\n\r\n    this.socket.onmessage = (message) => {\r\n      const messageData = JSON.parse(message.data);\r\n      this.addMessage(messageData);\r\n    };\r\n\r\n    this.socket.onclose = () => {\r\n      this.setState({\r\n        socket: new WebSocket(URL),\r\n      });\r\n    };\r\n  };\r\n\r\n  render() {\r\n    const { messages } = this.state;\r\n    return (\r\n      <div className=\"container jumbotron\">\r\n        <ChatForm\r\n          socket={this.socket}\r\n          onSubmitMessage={(messageString) => this.submitMessage(messageString)}\r\n        />\r\n        {messages.map((message, index) => (\r\n          <ChatMessage\r\n            key={index}\r\n            message={message.message}\r\n            pseudo={message.pseudo}\r\n          />\r\n        ))}\r\n      </div>\r\n    );\r\n  };\r\n};\r\n\r\nexport default Taverne;\r\n"]},"metadata":{},"sourceType":"module"}